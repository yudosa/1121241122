# 흥덕청소년 문화의집 시설 이용 예약 시스템

## 개요
흥덕청소년 문화의집의 시설 이용 예약을 관리하는 웹 애플리케이션입니다. 
모바일, 태블릿, 데스크톱 모든 디바이스에서 최적화된 사용자 경험을 제공합니다.

## 기능
- 시설 예약 생성 및 관리
- 예약 현황 조회
- 예약 취소 기능
- 시설별 상세 정보 제공

## 로컬 개발 환경 설정

### 1. 의존성 설치
```bash
npm install
```

### 2. 데이터베이스 초기화
```bash
npm run init-db
```

### 3. 개발 서버 실행
```bash
npm run dev
```

서버는 `http://localhost:3000`에서 실행됩니다.

## 배포 환경 설정

### Vercel 배포
1. Vercel CLI 설치
```bash
npm i -g vercel
```

2. 프로젝트 배포
```bash
vercel
```

3. 환경 변수 설정 (Vercel 대시보드에서)
```
NODE_ENV=production
DATABASE_PATH=/tmp/reservations.db
```

### 배포 시 주의사항

#### 1. 데이터베이스 파일 경로
- Vercel과 같은 서버리스 환경에서는 `/tmp` 디렉토리를 사용해야 합니다.
- 환경 변수 `DATABASE_PATH`를 `/tmp/reservations.db`로 설정하세요.

#### 2. CORS 설정
- `app.js`의 `allowedOrigins` 배열에 실제 배포 도메인을 추가하세요.
- 예: `https://your-app.vercel.app`

#### 3. 데이터베이스 지속성
- 서버리스 환경에서는 데이터베이스 파일이 재시작 시 초기화될 수 있습니다.
- 프로덕션 환경에서는 PostgreSQL, MongoDB 등의 클라우드 데이터베이스 사용을 권장합니다.

## 문제 해결

### 예약 생성이 안 되는 경우

1. **브라우저 개발자 도구 확인**
   - Network 탭에서 API 요청/응답 확인
   - Console 탭에서 에러 메시지 확인

2. **서버 로그 확인**
   - Vercel 대시보드의 Functions 로그 확인
   - 로컬에서는 터미널에서 로그 확인

3. **일반적인 문제들**
   - CORS 오류: `allowedOrigins`에 도메인 추가
   - 데이터베이스 권한 오류: `DATABASE_PATH`를 `/tmp`로 설정
   - 네트워크 오류: API 엔드포인트 URL 확인

### 디버깅 방법

1. **프론트엔드 디버깅**
   - 브라우저 개발자 도구의 Console에서 로그 확인
   - Network 탭에서 API 요청 상태 확인

2. **백엔드 디버깅**
   - 서버 로그에서 상세한 에러 정보 확인
   - 데이터베이스 연결 상태 확인

## API 엔드포인트

- `GET /api/reservations` - 모든 예약 조회
- `POST /api/reservations` - 새 예약 생성
- `GET /api/reservations/date/:date` - 특정 날짜 예약 조회
- `DELETE /api/reservations/:id` - 예약 삭제
- `GET /api/reservations/facilities` - 시설 목록 조회

## 기술 스택
- Backend: Node.js, Express.js
- Database: SQLite
- Frontend: HTML, CSS, JavaScript
- 배포: Vercel (권장)

## 🏗️ 프로젝트 구조

```
reservation-backend/
├── app.js                 # Express 서버 메인 파일
├── package.json           # 프로젝트 의존성 및 스크립트
├── database/
│   ├── database.js        # SQLite 데이터베이스 설정
│   └── reservations.db    # SQLite 데이터베이스 파일
├── routes/
│   └── reservations.js    # 예약 관련 API 라우트
├── public/                # 프론트엔드 파일들
│   ├── index.html         # 메인 페이지 (시설 선택)
│   ├── select-facility.html # 시설 선택 페이지
│   ├── reservation-date.html # 날짜 및 시간 선택 페이지
│   ├── reservation-complete.html # 예약 완료 페이지
│   ├── cancel-reservation.html # 예약 취소 페이지
│   ├── admin.html         # 관리자 페이지
│   ├── status.html        # 예약 현황 페이지
│   ├── rental.html        # 물품 대여 페이지
│   ├── styles.css         # 스타일시트
│   ├── script.js          # 공통 JavaScript
│   └── [기타 HTML 파일들]
└── README.md              # 프로젝트 문서
```

## ✨ 주요 기능

### 🎯 핵심 기능
- **동적 시설 선택**: 선택한 시설에 따라 세부 옵션이 자동으로 변경
- **실시간 달력**: 실제 월별 달력과 과거 날짜 자동 비활성화
- **스마트 시간 선택**: 오전/오후 탭과 1시간 단위 시간 슬롯 (09:00-19:00)
- **중복 예약 방지**: 동일 시간대 중복 예약 자동 차단
- **예약 완료 페이지**: 모던한 카드 디자인의 예약 확인 페이지
- **예약 취소 시스템**: 이름과 전화번호로 예약 조회 및 취소
- **모달 다이얼로그**: 확인 및 알림을 위한 사용자 친화적 모달

### 🏢 지원 시설 (층별 구성)
- **1층**: 댄스연습실 (단일 공간)
- **2층**: 닌텐도 (9개 개별 기기 - 닌텐도1~9)
- **3층**: 플레이스테이션 (2개 개별 기기 - PS1, PS2)
- **4층**: 노래방 (2개 개별 방 - 노래방1, 노래방2)
- **5층**: 보드게임 (2개 개별 공간 - 보드게임1, 보드게임2)

### 📱 사용자 인터페이스
- **시설 선택**: 동적 드롭다운으로 시설 및 세부 옵션 선택
- **날짜 선택**: 실제 월별 달력 네비게이션
- **시간 선택**: 오전/오후 탭과 1시간 단위 시간 슬롯 (09:00-19:00)
- **예약 완료**: 모던한 카드 디자인의 확인 페이지
- **예약 취소**: 이름/전화번호 기반 예약 조회 및 취소
- **관리자 페이지**: 전체 예약 현황 관리

## 🚀 설치 및 실행

### 필수 요구사항
- Node.js (v14 이상)
- npm 또는 yarn

### 1. 프로젝트 클론
```bash
git clone [repository-url]
cd reservation-backend
```

### 2. 의존성 설치
```bash
npm install
```

### 3. 데이터베이스 초기화
```bash
npm run init-db
```

### 4. 서버 실행
```bash
# 개발 모드 (nodemon 사용)
npm run dev

# 프로덕션 모드
npm start
```

### 5. 접속
브라우저에서 `http://localhost:3000`으로 접속

## 📊 데이터베이스

### SQLite 데이터베이스 구조

#### reservations 테이블
| 필드 | 타입 | 설명 |
|------|------|------|
| id | INTEGER | 고유 식별자 (자동 증가) |
| name | TEXT | 예약자 이름 |
| phone | TEXT | 연락처 |
| facility | TEXT | 시설명 |
| detail | TEXT | 세부 시설 (기본값: '-') |
| date | TEXT | 예약 날짜 (YYYY-MM-DD) |
| start_time | TEXT | 시작 시간 (HH:mm) |
| end_time | TEXT | 종료 시간 (HH:mm) |
| purpose | TEXT | 이용 목적 |
| created_at | DATETIME | 생성 시간 (자동) |

## 🔌 API 문서

### 예약 관련 API

#### 1. 모든 예약 조회
```http
GET /api/reservations
```

#### 2. 특정 날짜 예약 조회
```http
GET /api/reservations/date/:date
```

#### 3. 새 예약 생성
```http
POST /api/reservations
Content-Type: application/json

{
  "name": "홍길동",
  "phone": "010-1234-5678",
  "facility": "닌텐도",
  "detail": "닌텐도1",
  "date": "2024-01-15",
  "start_time": "14:00",
  "end_time": "16:00",
  "purpose": "게임"
}
```

#### 4. 예약 삭제
```http
DELETE /api/reservations/:id
```

#### 5. 이름/전화번호로 예약 조회
```http
GET /api/reservations/search?name=홍길동&phone=010-1234-5678
```

## 🎨 프론트엔드 기능

### 동적 시설 선택 시스템
- **시설 선택**: 메인 시설 선택 시 세부 옵션 자동 업데이트
- **층별 구성**: 각 시설의 층별 위치 정보 표시
- **실시간 검증**: 선택된 시설에 따른 유효성 검사

### 스마트 달력 시스템
- **실제 월별 달력**: 현재 월의 실제 날짜 표시
- **월 네비게이션**: 이전/다음 월 이동 기능
- **과거 날짜 비활성화**: 오늘 이전 날짜 자동 비활성화
- **시각적 피드백**: 선택된 날짜 하이라이트

### 지능형 시간 선택
- **오전/오후 탭**: AM/PM 구분으로 시간대별 선택
- **1시간 단위 슬롯**: 09:00-19:00 시간대 (09:00, 10:00, 11:00, 12:00, 13:00, 14:00, 15:00, 16:00, 17:00, 18:00, 19:00)
- **과거 시간 비활성화**: 현재 시간 이전 슬롯 자동 비활성화
- **예약된 시간 비활성화**: 이미 예약된 시간 자동 비활성화 및 "(예약됨)" 표시
- **실시간 업데이트**: 날짜 변경 시 시간 슬롯 자동 업데이트
- **시각적 피드백**: 선택된 시간 하이라이트 및 비활성화된 시간 취소선 표시

### 예약 완료 시스템
- **모던 카드 디자인**: 깔끔한 예약 확인 카드
- **사용자 정보 표시**: 예약자 이름, 연락처
- **예약 상세 정보**: 시설, 날짜, 시간, 목적
- **예약 번호**: 고유 예약 식별자

### 예약 취소 시스템
- **이름/전화번호 검색**: 간편한 예약 조회
- **예약 목록 표시**: 사용자의 모든 예약 표시
- **취소 확인 모달**: 예약 상세 정보와 함께 취소 확인
- **테스트 데이터**: 개발용 샘플 예약 데이터

### 모달 다이얼로그 시스템
- **확인 모달**: 예약 취소 등 중요 작업 확인
- **알림 모달**: 성공/실패 메시지 표시
- **일관된 스타일**: 앱 전체 통일된 모달 디자인

### 반응형 디자인
- **모바일 최적화**: 터치 친화적 인터페이스
- **데스크톱 지원**: 넓은 화면에서의 최적화
- **접근성**: 키보드 네비게이션 지원

## 🔧 개발 환경 설정

### 개발 모드 실행
```bash
npm run dev
```
- nodemon을 사용하여 파일 변경 시 자동 재시작
- 실시간 개발 환경 제공

### 프로덕션 모드 실행
```bash
npm start
```
- 안정적인 프로덕션 환경

## 📝 사용 예시

### 1. 시설 예약하기
1. 웹사이트 접속 (`http://localhost:3000`)
2. 시설 선택 페이지에서 원하는 시설 선택
3. 날짜 선택 페이지에서:
   - 원하는 날짜 클릭 (과거 날짜는 비활성화됨)
   - 오전/오후 탭 선택
   - 원하는 시간 슬롯 선택 (예약된 시간은 비활성화됨)
4. 예약 정보 입력:
   - 이름, 연락처
   - 이용 목적
5. "예약하기" 버튼 클릭
6. 예약 완료 페이지에서 예약 정보 확인

### 2. 예약 취소하기
1. "예약 취소" 메뉴 선택
2. 이름과 전화번호 입력
3. "예약 조회" 버튼 클릭
4. 예약 목록에서 취소할 예약 선택
5. "취소하기" 버튼 클릭
6. 확인 모달에서 "확인" 클릭

### 3. 예약 현황 확인
1. "관리자" 페이지 접속
2. 날짜별 예약 현황 확인
3. 시설별 사용 현황 파악

## 🛠️ 기술 스택

### 백엔드
- **Node.js**: 서버 런타임
- **Express.js**: 웹 프레임워크
- **SQLite3**: 데이터베이스
- **CORS**: 크로스 오리진 요청 처리

### 프론트엔드
- **HTML5**: 시맨틱 마크업
- **CSS3**: 모던 스타일링 및 애니메이션
- **JavaScript**: 동적 인터페이스 및 API 통신
- **LocalStorage**: 임시 데이터 저장

### 개발 도구
- **Nodemon**: 개발 시 자동 재시작
- **Body-parser**: 요청 데이터 파싱

## 🔒 보안 및 검증

### 입력 검증
- 필수 필드 검증
- 날짜/시간 형식 검증
- 과거 날짜/시간 예약 방지
- 시간 순서 검증 (시작 < 종료)

### 중복 예약 방지
- 동일 시설, 동일 시간대 중복 예약 자동 차단
- 세부 시설까지 고려한 정확한 중복 검사
- 실시간 예약 상태 확인

### 데이터 무결성
- SQLite 트랜잭션 사용
- 예약 삭제 시 데이터 일관성 보장

## 🎨 UI/UX 특징

### 사용자 경험
- **직관적 네비게이션**: 단계별 예약 프로세스
- **실시간 피드백**: 즉시적인 사용자 피드백
- **오류 방지**: 잘못된 선택 방지를 위한 UI 설계
- **접근성**: 다양한 사용자를 위한 접근성 고려

### 시각적 디자인
- **모던한 카드 디자인**: 깔끔하고 현대적인 UI
- **일관된 색상 체계**: 브랜드 일관성 유지
- **반응형 레이아웃**: 모든 디바이스에서 최적화
- **부드러운 애니메이션**: 사용자 경험 향상

## 📞 지원 및 문의

프로젝트 관련 문의사항이나 버그 리포트는 이슈 트래커를 통해 제출해 주세요.

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

---

**흥덕청소년 문화의집** - 청소년들의 문화 활동을 위한 최고의 공간 

PGHOST=your-supabase-host.supabase.co
PGUSER=your-db-username
PGPASSWORD=your-db-password
PGDATABASE=your-db-name 

const db = require('./database/database');
db.pool.connect()
  .then(() => console.log('PostgreSQL 연결 성공!'))
  .catch(err => {
    console.error('PostgreSQL 연결 실패:', err.message);
    process.exit(1);
  }); 

## ☁️ Cloudtype + GitHub 자동 배포 안내

### 자동 배포 동작 방식
- Cloudtype에 GitHub 저장소가 연동되어 있다면, main/master 브랜치에 코드를 push할 때마다 자동으로 배포가 진행됩니다.
- Cloudtype의 '자동 배포' 옵션이 켜져 있어야 하며, 배포 이력 및 로그에서 자동 반영 여부를 확인할 수 있습니다.

### 자동 배포 설정 방법
1. Cloudtype 대시보드에서 프로젝트 생성 시 GitHub 저장소를 연동합니다.
2. '자동 배포' 옵션을 활성화합니다.
3. main/master 브랜치에 push하면 자동으로 최신 코드가 배포됩니다.

### 수동 배포가 필요한 경우
- 자동 배포가 꺼져 있거나, 브랜치 설정이 다를 경우에는 Cloudtype 대시보드에서 직접 '배포' 버튼을 눌러야 변경사항이 반영됩니다.

### 참고
- Cloudtype 대시보드의 '배포 이력' 또는 '로그'에서 배포 상태를 확인할 수 있습니다.
- 자동 배포가 정상 동작하지 않을 경우, Cloudtype의 '자동 배포' 설정을 다시 확인하세요. 

## ✨ 주요 UI/UX 개선점

- **앱처럼 한 화면에 주요 정보가 보이도록 레이아웃과 여백을 최적화**
- **여백 최소화, 탭과 안내 카드가 한 화면에 딱 붙게, 불필요한 공백 완전 제거**
- **모든 주요 섹션(이용현황, 시설 안내, QR 안내 등) 간의 공백까지 완전히 제거하여 한 페이지처럼 자연스럽게 연결**
- **안내 카드(시설 안내/QR 안내) 높이 균등하게 맞춤**
- **이용신청/예약취소/이용현황 탭 버튼의 가로 길이 증가로 터치 및 가독성 향상**
- **태블릿 세로에서는 안내 카드가 세로로, 가로/PC에서는 2열로, 모바일에서는 세로로 자연스럽게 배치되어 기기 방향에 따라 UX가 최적화됨**
- **기기별(PC/태블릿/모바일) 레이아웃 최적화 및 한 페이지 UX 실현**

## 📱 반응형 디자인 상세

- 태블릿/PC/모바일에서 한 페이지 UX 실현
- 모든 주요 섹션(탭, 안내 카드 등) 간의 간격까지 완전히 붙게 최적화
- 태블릿 최적화 (768px - 1024px): 레이아웃 안정성, 한 페이지 표시, 터치 최적화, 가독성 향상
- 모바일 최적화 (768px 이하): 단일 컬럼, 터치 친화적, 빠른 로딩
- 데스크톱 지원 (1024px 이상): 다중 컬럼, 마우스 인터랙션, 고해상도 지원
- 안내 카드(시설 안내/QR 안내) 높이 균등, 탭 버튼 가로 길이 증가 등 최신 UX 반영
